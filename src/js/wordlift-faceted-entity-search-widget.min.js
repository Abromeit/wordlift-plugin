(function(){var a,b,c,d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("wordlift.ui.carousel",[]).directive("wlCarousel",["$window","$log",function(a,b){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-show="panes.length > 0">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-right="next()"></div>\n  <div class="wl-carousel-arrow wl-prev" ng-click="prev()" ng-show="currentPaneIndex > 0">\n    <i class="wl-angle-left" />\n  </div>\n  <div class="wl-carousel-arrow wl-next" ng-click="next()" ng-show="isNextArrowVisible()">\n    <i class="wl-angle-right" />\n  </div>\n</div>',controller:["$scope","$element","$attrs",function(b,c,d){var e,f;return f=angular.element(a),b.visibleElements=function(){return c.width()>460?3:1},b.setItemWidth=function(){return c.width()/b.visibleElements()},b.itemWidth=b.setItemWidth(),b.panesWidth=void 0,b.panes=[],b.position=0,b.currentPaneIndex=0,b.isNextArrowVisible=function(){return b.panes.length-b.currentPaneIndex>b.visibleElements()},b.next=function(){return b.position=b.position-b.itemWidth,b.currentPaneIndex=b.currentPaneIndex+1},b.prev=function(){return b.position=b.position+b.itemWidth,b.currentPaneIndex=b.currentPaneIndex-1},b.setPanesWrapperWidth=function(){return b.panesWidth=b.panes.length*b.itemWidth,b.position=0,b.currentPaneIndex=0},f.bind("resize",function(){var a,c,d,e;for(b.itemWidth=b.setItemWidth(),b.setPanesWrapperWidth(),e=b.panes,a=0,c=e.length;c>a;a++)d=e[a],d.scope.setWidth(b.itemWidth);return b.$apply()}),e=this,e.registerPane=function(a,c){var d;return a.setWidth(b.itemWidth),d={scope:a,element:c},b.panes.push(d),b.setPanesWrapperWidth()},e.unregisterPane=function(a){var c,d,e,f,g,h;for(h=void 0,g=b.panes,d=c=0,e=g.length;e>c;d=++c)f=g[d],f.scope.$id===a.$id&&(h=d);return b.panes.splice(h,1),b.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(a){return{require:"^wlCarousel",restrict:"EA",transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d,e){return a.debug("Going to add carousel pane with id "+b.$id+" to carousel"),c.addClass("wl-carousel-item"),b.setWidth=function(a){return c.css("width",a+"px")},b.$on("$destroy",function(){return a.debug("Destroy "+b.$id),e.unregisterPane(b)}),e.registerPane(b,c)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(a,b,c){return{restrict:"A",compile:function(b,c){return function(b,d){var e;return e=a(c.wlOnError),d.on("error",function(a){var c;return c=function(){return e(b,{$event:a})},b.$apply(c)})}}}}]).directive("wlFallback",["$window","$log",function(a,b){return{restrict:"A",priority:99,link:function(a,c,d,e){return c.bind("error",function(){return d.src!==d.wlFallback?(b.warn("Error on "+d.src+"! Going to fallback on "+d.wlFallback),d.$set("src",d.wlFallback)):void 0})}}}]),a=jQuery,angular.module("wordlift.facetedsearch.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var a,b;return a=void 0,b={setConfiguration:function(b){return a=b},$get:function(){return a}}}).filter("filterEntitiesByType",["$log","configuration",function(a,b){return function(a,b){var c,e,f,g;e=[];for(f in a)c=a[f],g=c.mainType,d.call(b,g)>=0&&e.push(c);return e}}]).controller("FacetedSearchWidgetController",["DataRetrieverService","configuration","$scope","$log",function(a,b,c,d){return c.entity=void 0,c.posts=[],c.facets=[],c.conditions={},c.entityLimit=5,c.supportedTypes=[{scope:"what",types:["thing","creative-work"]},{scope:"who",types:["person","organization","local-business"]},{scope:"where",types:["place"]},{scope:"when",types:["event"]}],c.configuration=b,c.filteringEnabled=!0,c.toggleFacets=function(){return d.debug("Clicked!"),c.configuration.attrs.show_facets=!c.configuration.attrs.show_facets},c.isInConditions=function(a){return c.conditions[a.id]?!0:!1},c.addCondition=function(b){return d.debug("Add entity "+b.id+" to conditions array"),c.conditions[b.id]?delete c.conditions[b.id]:c.conditions[b.id]=b,a.load("posts",Object.keys(c.conditions))},c.$on("postsLoaded",function(a,e){return d.debug("Referencing posts for item "+b.post_id+" ..."),c.posts=e}),c.$on("facetsLoaded",function(a,e){return d.debug("Referencing facets for item "+b.post_id+" ..."),c.facets=e})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var e;return e={},e.load=function(e,f){var g;return null==f&&(f=[]),g=a.ajax_url+"?action="+a.action+"&post_id="+a.post_id+"&type="+e,b.debug("Going to search "+e+" with conditions"),c({method:"post",url:g,data:f}).success(function(a){return d.$broadcast(e+"Loaded",a)}).error(function(a,c){return b.warn("Error loading "+e+", statut "+c)})},e}]).config(["configurationProvider",function(a){return a.setConfiguration(window.wl_faceted_search_params)}]),a(b=a('<div ng-controller="FacetedSearchWidgetController" ng-show="posts.length > 0">\n      <h4 class="wl-headline">\n        {{configuration.attrs.title}}\n        <i class="wl-toggle-on" ng-hide="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n        <i class="wl-toggle-off" ng-show="configuration.attrs.show_facets" ng-click="toggleFacets()"></i>\n      </h4>\n      <div ng-show="configuration.attrs.show_facets" class="wl-facets" ng-show="filteringEnabled">\n        <div class="wl-facets-container" ng-repeat="box in supportedTypes">\n          <h6>{{box.scope}}</h6>\n          <ul>\n            <li class="entity" ng-repeat="entity in facets | orderBy:[ \'-counter\', \'-createdAt\' ] | filterEntitiesByType:box.types | limitTo:entityLimit" ng-click="addCondition(entity)">     \n                <span class="wl-label" ng-class=" { \'selected\' : isInConditions(entity) }">\n                  <i class="wl-checkbox"></i>\n                  <i class="wl-type" ng-class="\'wl-fs-\' + entity.mainType"></i>  \n                  {{entity.label}}\n                  <span class="wl-counter">({{entity.counter}})</span>\n                </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n      <div class="wl-posts">\n        <div wl-carousel>\n          <div class="wl-post wl-card" ng-repeat="post in posts" wl-carousel-pane>\n            <div class="wl-card-image"> \n                <span style="background: url({{post.thumbnail}}) no-repeat center center; background-size: cover;"></span>\n            </div>\n            <div class="wl-card-title"> \n              <a ng-href="{{post.permalink}}">{{post.post_title}}</a>\n            </div>\n          </div>\n        </div>\n  \n      </div>\n     \n    </div>').appendTo("#wordlift-faceted-entity-search-widget"),c=angular.bootstrap(a("#wordlift-faceted-entity-search-widget"),["wordlift.facetedsearch.widget"]),c.invoke(["DataRetrieverService","$rootScope","$log",function(a,b,c){return b.$apply(function(){return a.load("posts"),a.load("facets")})}]))}).call(this);